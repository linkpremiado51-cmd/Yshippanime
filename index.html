<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Assista seus animes favoritos no Anime I Geek">
    <title>Anime I Geek - Sua Home de Animes</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jura:wght@300..700&family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
/* INÍCIO DO CSS UNIFICADO (Original, sem alterações) */
html {
    scroll-behavior: smooth;
    font-size: 16px;
}
:root {
    --primary-gradient: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
    --text-primary: #1a202c;
    --text-secondary: #4a5568;
    --background: #f5f7fa;
    --surface: rgba(0, 0, 0, 0.05);
    --border: rgba(0, 0, 0, 0.1);
    --shadow-color: rgba(0, 0, 0, 0.2);
    --blur-effect: blur(12px);
    --transition: all 0.6s ease-in-out;
    --highlight-color: #E53E3E;
    --highlight-hover: #C53030;
    --watch-later-color: #38A169;
    --watch-later-hover: #2F855A;
    --episodes-color: #2D3748;
    --episodes-hover: #4A5568;
    --report-error-color: #4B5563;
    --report-error-hover: #6B7280;
    --menu-background: rgba(255, 255, 255, 0.65);
    --menu-item-background: rgba(0, 0, 0, 0.05);
    --menu-item-hover-background: rgba(0, 0, 0, 0.1);
    --spacing-sm: 12px;
    --spacing-md: 20px;
    --spacing-section: 40px;
    --font-size-xs: clamp(0.8rem, 2vw, 1rem);
    --font-size-sm: clamp(1rem, 2.5vw, 1.1rem);
    --font-size-md: clamp(1.1rem, 3vw, 1.3rem);
    --font-size-lg: clamp(1.4rem, 4vw, 1.8rem);
    --primary: #2d3748;
    --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.15);
    --menu-bg-light: rgba(255, 255, 255, 0.5);
    --menu-bg-dark: rgba(45, 55, 72, 0.5);
    --card-bg: #ffffff;
    --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    --header-bg: var(--surface);
    --progress-bg: #edf2f7;
    --zoom-scale: 1.0;
    --watch-now-button-width: 150px;
    --cover-button-opacity: 0.8;
}
[data-theme="dark"] {
    --text-primary: #e2e8f0;
    --text-secondary: #a0aec0;
    --background: #1a202c;
    --surface: rgba(255, 255, 255, 0.05);
    --border: #4a5568;
    --shadow-color: rgba(0, 0, 0, 0.4);
    --menu-background: rgba(45, 55, 72, 0.65);
    --menu-item-background: rgba(255, 255, 255, 0.05);
    --menu-item-hover-background: rgba(255, 255, 255, 0.1);
    --card-bg: #374151;
    --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.4);
    --progress-bg: #4a5568;
}
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    user-select: text !important;
    -webkit-user-select: text !important;
}
body {
    font-family: 'Jura', sans-serif;
    font-weight: 400;
    line-height: 1.5;
    background: var(--background);
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
    touch-action: pan-y;
    transition: background 0.3s ease, color 0.3s ease;
    overscroll-behavior-x: none;
}
.zoom-container {
    width: 100%;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 0;
}
.header-menu {
    width: 100%;
}
.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 65px;
    background: var(--header-bg, var(--surface));
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 16px;
    z-index: 1001;
    box-shadow: var(--shadow);
    transition: background 0.3s ease;
}
.header h1 {
    font-size: 1.125rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-primary);
}
:fullscreen .header {
    display: none !important;
}
:-webkit-full-screen .header {
    display: none !important;
}
.top-bar__section {
    display: flex;
    align-items: center;
    gap: 12px;
}
.top-bar__icon {
    color: var(--text-primary);
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
    border-radius: 0px;
}
.top-bar__icon i {
    font-size: 1.125rem;
}
.top-bar__icon:hover {
    background: var(--primary);
    color: white;
}
.top-bar__icon:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.hamburger-menu {
    position: fixed;
    top: 0;
    right: -300px;
    width: 280px;
    max-width: 80%;
    height: 100%;
    background: var(--menu-background);
    backdrop-filter: var(--blur-effect);
    z-index: 4000;
    transition: right 0.3s ease-in-out;
    box-shadow: -4px 0 12px var(--shadow-color);
    padding: 65px 20px 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}
.hamburger-menu.open {
    right: 0;
}
.menu-item {
    padding: 15px;
    margin-bottom: 8px;
    background: var(--menu-item-background);
    color: var(--text-primary);
    text-decoration: none;
    font-size: 1rem;
    font-weight: 500;
    border-radius: 0px;
    transition: background 0.2s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}
.menu-item:hover {
    background: var(--menu-item-hover-background);
}
.menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 3999;
    display: none;
}
.menu-overlay.active {
    display: block;
}
.menu {
    position: fixed;
    top: 65px;
    left: 0;
    right: 0;
    width: 100%;
    height: 50vh;
    background: var(--menu-bg-light);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    box-shadow: var(--shadow-lg);
    transform: translateY(-100%);
    transition: transform 0.4s ease;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 16px;
    opacity: 0;
    pointer-events: none;
}
[data-theme="dark"] .menu {
    background: var(--menu-bg-dark);
}
.menu.open {
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
}
.search-container {
    width: 100%;
    max-width: 600px;
    position: relative;
    margin-bottom: 16px;
}
.search-input {
    width: 100%;
    padding: 14px 50px 14px 16px;
    font-size: 1rem;
    border: 1px solid var(--border);
    border-radius: 0px;
    background: var(--surface);
    color: var(--text-primary);
    outline: none;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}
.search-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(45, 55, 72, 0.1);
}
.search-icon {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    font-size: 1.1rem;
    pointer-events: none;
}
.result-card {
    width: 100%;
    max-width: 600px;
    background: var(--card-bg);
    border-radius: 0px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    display: none;
    flex-direction: column;
    gap: 12px;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.4s ease;
    margin-top: 8px;
}
.result-card.show {
    opacity: 1;
    transform: translateY(0);
    display: flex;
}
.result-suggestion-item {
    display: flex;
    align-items: center;
    padding: 10px 12px;
    border-radius: 0px;
    text-decoration: none;
    color: var(--text-primary);
    transition: background 0.2s ease;
    width: 100%;
}
.result-suggestion-item:hover {
    background: var(--menu-item-hover-background);
}
.result-suggestion-item i {
    margin-right: 12px;
    color: var(--text-secondary);
    width: 20px;
    text-align: center;
}
.result-suggestion-title {
    font-weight: 500;
    font-size: 0.95rem;
}
.notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 15px 30px;
    box-shadow: 0 4px 12px var(--shadow-color);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 2000;
    font-size: var(--font-size-md);
    font-weight: 500;
    text-align: center;
    max-width: 90%;
    width: 400px;
    border-radius: 0px;
}
[data-theme="light"] .notification {
    background: rgba(255, 255, 255, 0.95);
    color: var(--text-primary);
}
[data-theme="dark"] .notification {
    background: rgba(18, 21, 32, 0.95);
    color: var(--text-primary);
}
.notification.show {
    opacity: 1;
}
.footer {
    width: 100%;
    background: var(--surface);
    color: var(--text-secondary);
    text-align: center;
    padding: 16px 16px;
    margin-top: var(--spacing-section);
    box-shadow: 0 -2px 5px var(--shadow-color);
    font-size: var(--font-size-xs);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
}
.footer-left {
    display: flex;
    align-items: center;
    gap: 8px;
}
.footer-right {
    text-align: right;
}
.footer a {
    color: var(--highlight-color);
    text-decoration: none;
    margin: 0 10px;
    transition: color 0.2s ease;
}
.footer a:hover {
    color: var(--highlight-hover);
}
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.fade-in {
    animation: fadeIn 0.4s ease-out forwards;
}
@media (max-width: 768px) {
    :root {
        --spacing-section: 25px;
    }
    .header {
        padding: 0 12px;
        height: 55px;
    }
    .header h1 {
        font-size: 1rem;
    }
    .top-bar__icon i {
        font-size: 1rem;
    }
    .notification {
        font-size: var(--font-size-sm);
        padding: 10px 20px;
        width: 300px;
    }
    .zoom-container {
        padding-top: 0;
    }
    .menu {
        top: 55px;
    }
    .top-bar__icon {
        padding: 6px;
    }
    .footer {
        flex-direction: column;
        align-items: flex-start;
        padding-bottom: 70px;
    }
    .footer-left {
        width: 100%;
        margin-bottom: 10px;
        justify-content: center;
    }
    .footer-right {
        text-align: center;
        width: 100%;
    }
}
@media (max-width: 480px) {
   /* Estilos mobile */
}
@media (min-width: 601px) and (max-width: 1024px) {
    .header h1 {
        font-size: 1.125rem;
    }
}
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 5000;
    display: none;
    justify-content: center;
    align-items: center;
}
.modal-content {
    background: var(--background);
    color: var(--text-primary);
    padding: 30px;
    border-radius: 0px;
    width: 90%;
    max-width: 400px;
    box-shadow: var(--shadow-lg);
    animation: fadeIn 0.3s ease-out;
}
.modal-content h3 {
    font-size: var(--font-size-md);
    font-weight: 700;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--highlight-color);
    padding-bottom: 10px;
}
.report-option {
    display: block;
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    background: var(--menu-item-background);
    border: 1px solid var(--border);
    border-radius: 0px;
    text-align: left;
    cursor: pointer;
    transition: background 0.2s;
    font-size: var(--font-size-sm);
    display: flex;
    align-items: center;
    gap: 10px;
}
.report-option:hover {
    background: var(--menu-item-hover-background);
}
.modal-close-btn {
    display: block;
    width: 100%;
    padding: 10px;
    margin-top: 20px;
    background: var(--highlight-color);
    color: white;
    border: none;
    border-radius: 0px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.2s;
}
.modal-close-btn:hover {
    background: var(--highlight-hover);
}
.fixed-footer-controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 50px;
    background: var(--header-bg, var(--surface));
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding: 0 16px;
    z-index: 1002;
    box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1);
    gap: 10px;
}
@media (min-width: 769px) {
    .fixed-footer-controls {
        display: none;
    }
    .footer {
        padding: 16px;
    }
}
@media (max-width: 768px) {
    .zoom-container main {
        padding-bottom: 120px;
    }
}


/* =====================================================
   ✨ NOVOS ESTILOS PARA A PÁGINA INICIAL
   ===================================================== */
.hero-section {
    width: 100%;
    max-width: 1000px; /* Alinhado com o resto do conteúdo */
    margin: 65px auto 0; /* Abaixo do header */
    height: 400px;
    background: var(--surface);
    border-radius: 0px;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
}
.hero-slide {
    width: 100%;
    height: 100%;
    position: absolute;
    opacity: 0;
    transition: opacity 1s ease-in-out;
    text-decoration: none;
}
.hero-slide.active {
    opacity: 1;
}
.hero-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.hero-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
    padding: var(--spacing-md);
    color: white;
}
.hero-info h2 {
    font-size: var(--font-size-lg);
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}
.hero-info p {
    font-size: var(--font-size-sm);
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

.anime-carousel-section {
    width: 100%;
    max-width: 1000px;
    margin: var(--spacing-section) auto 0;
    padding: 0 0.75rem;
}

/* Reutilizando o estilo de título do carrossel original */
.carousel-title {
    font-family: 'Ubuntu', sans-serif;
    font-size: var(--font-size-lg);
    font-weight: 700;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 15px;
    padding: 5px 0;
    border-bottom: 3px solid var(--highlight-color);
    display: inline-block;
    line-height: 1;
}

.anime-grid {
    display: grid;
    /* Grid responsivo: preenche com o máximo de colunas de 160px */
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: var(--spacing-md);
}

.anime-card {
    background: var(--card-bg);
    border-radius: 0px;
    box-shadow: var(--shadow);
    transition: var(--transition);
    text-decoration: none;
    color: var(--text-primary);
    overflow: hidden;
    /* Adiciona animação de fade-in */
    opacity: 0;
    transform: translateY(10px);
    animation: fadeIn 0.5s ease-out forwards;
}
.anime-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}
.anime-card-image {
    width: 100%;
    padding-bottom: 140%; /* Proporção 10:14 (Altura) */
    background-size: cover;
    background-position: center;
    background-color: var(--surface);
}
.anime-card-info {
    padding: var(--spacing-sm);
}
.anime-card-title {
    font-size: var(--font-size-sm);
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.anime-card-subtitle {
    font-size: var(--font-size-xs);
    color: var(--text-secondary);
}

/* ==========================================================
   ✨ ALTERAÇÕES PARA 4 COLUNAS NO MOBILE (SOLICITADO)     
   ========================================================== */

@media (max-width: 768px) {
    .hero-section {
        height: 300px;
        margin-top: 55px; /* Abaixo do header mobile */
    }

    /* ALTERAÇÃO: Transforma o grid em 4 colunas fixas */
    .anime-grid {
        display: grid; /* Mantém o grid */
        overflow-x: hidden; /* Garante que não haja scroll */
        /* FORÇA 4 COLUNAS */
        grid-template-columns: repeat(4, 1fr); /* <-- ALTERADO DE 3 PARA 4 */
        gap: calc(var(--spacing-sm) / 1.5); /* Gap de 8px */
    }

    .anime-card {
        width: 100%; 
        flex-shrink: 1; 
        
        /* Ajustes de padding e fonte para caber em 4 colunas */
        .anime-card-info {
             padding: calc(var(--spacing-sm) / 2); /* Padding de 6px */
        }
        .anime-card-title {
             font-size: calc(var(--font-size-xs) * 0.9); /* Fonte menor */
        }
        .anime-card-subtitle {
             font-size: calc(var(--font-size-xs) * 0.8); /* Fonte menor */
        }
    }
}

@media (max-width: 480px) {
    .hero-section {
        height: 250px;
    }
    
    /* Mantém a regra de 4 colunas aqui também */
    .anime-grid {
        grid-template-columns: repeat(4, 1fr); /* <-- ALTERADO DE 3 PARA 4 */
        gap: calc(var(--spacing-sm) / 2); /* Gap de 6px */
    }
}
    </style>
</head>
<body data-theme="light">
    <div class="header-menu">
        <nav class="header">
            <div class="top-bar__section">
                <h1><i class="fas fa-dragon"></i>Anime I Geek</h1>
            </div>
            <div class="top-bar__section">
                <button aria-label="Abrir busca" class="top-bar__icon" id="menu-icon">
                    <i class="fas fa-search"></i>
                </button>
                <button aria-label="Alternar tema" class="top-bar__icon" id="theme-toggle">
                    <i class="fas fa-adjust"></i>
                </button>
                <button aria-label="Abrir menu" class="top-bar__icon" id="hamburger-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>
        <nav class="menu" id="main-menu">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Pesquisar anime..." id="search-input">
                <i class="fas fa-search search-icon"></i>
            </div>
            <div class="result-card" id="result-card"></div>
        </nav>
        <div class="hamburger-menu" id="hamburgerMenu">
            <a href="#" class="menu-item"><i class="fas fa-tv"></i> Animes</a>
            <a href="#" class="menu-item"><i class="fas fa-user-plus"></i> Cadastrar</a>
            <a href="#" class="menu-item"><i class="fas fa-sign-in-alt"></i> Fazer Login</a>
            <a href="#" class="menu-item" onclick="closeHamburgerMenu()"><i class="fas fa-times"></i> Fechar</a>
        </div>
        <div class="menu-overlay" id="menuOverlay"></div>
    </div>

    <div class="zoom-container" id="zoom-container">
        
        <section class="hero-section" id="hero-section">
            <div class="hero-slide active">
                <img src="https://i.postimg.cc/1XXm0m8R/GP5HJ84P7-backdrop-wide.jpg" alt="Destaque" />
                <div class="hero-info">
                    <h2>Carregando destaques...</h2>
                    <p>Aguarde um momento.</p>
                </div>
            </div>
        </section>

        <main style="width:100%;max-width:1000px;padding:0 0.75rem 120px;margin:0 auto;">
            
            <section class="anime-carousel-section">
                <h2 class="carousel-title">Lançamentos</h2>
                <div class="anime-grid" id="recent-releases-grid">
                    </div>
            </section>

            <section class="anime-carousel-section">
                <h2 class="carousel-title">Populares</h2>
                <div class="anime-grid" id="popular-animes-grid">
                    </div>
            </section>
            
            <section class="anime-carousel-section">
                <h2 class="carousel-title">Adicionados Recentemente</h2>
                <div class="anime-grid" id="recently-added-grid">
                    </div>
            </section>
            <section class="anime-carousel-section">
                <h2 class="carousel-title">Visualizados Recentemente</h2>
                <div class="anime-grid" id="recentes-externo-grid">
                    </div>
            </section>

            <section class="anime-carousel-section">
                <h2 class="carousel-title">Gêneros</h2>
                <div class="anime-grid" id="generos-externo-grid">
                    </div>
            </section>

        </main>
    </div>
    <div class="footer">
        <div class="footer-left">
            </div>
        <div class="footer-right">
            <p>© 2025 Anime I Geek. Todos os direitos reservados. Desenvolvido por xAI.</p>
        </div>
    </div>

    <div class="fixed-footer-controls">
        <button aria-label="Diminuir zoom" class="top-bar__icon" id="zoom-out-btn-fixed">
            <i class="fas fa-search-minus"></i>
        </button>
        <button aria-label="Aumentar zoom" class="top-bar__icon" id="zoom-in-btn-fixed">
            <i class="fas fa-search-plus"></i>
        </button>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <div class="modal-overlay" id="reportErrorModal">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-triangle"></i> Reportar Problema</h3>
            <p>Selecione o problema encontrado (ex: link quebrado):</p>
            <button class="report-option" data-error-type="Link Quebrado"><i class="fas fa-link-slash"></i> Link Quebrado</button>
            <button class="report-option" data-error-type="Imagem Faltando"><i class="fas fa-image-slash"></i> Imagem Faltando</button>
            <button class="report-option" data-error-type="Outro Problema"><i class="fas fa-puzzle-piece"></i> Outro Problema</button>
            <button class="modal-close-btn" id="closeReportModal">Cancelar</button>
        </div>
    </div>
    
    <script type="module">
        // O JavaScript foi atualizado com novos dados e o novo carrossel
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
        import { getAnalytics, logEvent } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-analytics.js';
        import { getFirestore, collection, getDocs, doc, getDoc, addDoc } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';

        console.log('1. [INICIALIZAÇÃO] Iniciando script...');

        const firebaseConfig = {
            apiKey: "AIzaSyA9vB_anmutvZByIhKxsPJbsP0VZ7gyWB0",
            authDomain: "sorteio-mega-sorte.firebaseapp.com",
            projectId: "sorteio-mega-sorte",
            storageBucket: "sorteio-mega-sorte.appspot.com",
            messagingSenderId: "776750928407",
            appId: "1:776750928407:web:72da06deb8b97302b5c252",
            measurementId: "G-GD7D30N0G"
        };
        console.log('2. [FIREBASE] Configurações carregadas.');

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        console.log('3. [FIREBASE] App, Analytics e Firestore inicializados.');
        
        // Função utilitária para links em construção
        const CONSTRUCTION_LINK = "javascript:showNotification('Sistema em construção, volte mais tarde.')";
        const CONSTRUCTION_SUBTITLE = "Sistema em construção";

        const homepageData = {
            hero: [
                {
                    title: "Spy-Famyli",
                    subtitle: "Todos têm um lado oculto — numa época em que países ao redor do mundo estavam envolvidos numa feroz guerra de informação subterrânea.",
                    image: "https://i.postimg.cc/pL6hhZQs/28325-1-9-8b.webp",
                    url: CONSTRUCTION_LINK
                },
                {
                    title: "My Hero Academy final",
                    subtitle: "A nova temporada está aqui!",
                    image: "https://i.postimg.cc/5yTTQD0f/28328-1-9-8b.webp",
                    url: CONSTRUCTION_LINK
                },
                {
                    title: "L9999",
                    subtitle: "Ele quase foi morto nas profundezas da masmorra por seus companheiros de confiança, mas com o dom do Gacha Infinito, ele obtém companheiros de nível 9999 e se vinga de seus antigos companheiros de grupo e do mundo, dizendo: Bem feito para você",
                    image: "https://i.postimg.cc/GtCq0rHT/28329-1-9-8b.webp",
                    url: CONSTRUCTION_LINK
                }
            ],
            // -------------------------------------------------------------
           // Lançamentos (Animes que estão com novos episódios saindo)
// -------------------------------------------------------------
recentReleases: [
    { title: "My Hero Academia Final Season", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/wM05SzhW/IMG-20251111-112503.jpg", url: CONSTRUCTION_LINK },
    { title: "Spy × Family S3", subtitle: "Ep. 1 (4 de Out. 2025)", image: "https://i.postimg.cc/NMc3p8GT/IMG-20251111-111133.jpg", url: CONSTRUCTION_LINK },
    { title: "One‑Punch Man S3", subtitle: "Ep. 1 (12 de Out. 2025)", image: "https://i.postimg.cc/Tw040ZHV/images-2025-11-11T111248-289.jpg", url: CONSTRUCTION_LINK },
    { title: "Dusk Beyond the End of the World", subtitle: "Ep. 1 (26 de Set. 2025)", image: "https://i.postimg.cc/m2zm1zR8/IMG-20251111-111359.jpg", url: CONSTRUCTION_LINK },
    { title: "This Monster Wants to Eat Me!", subtitle: "Ep. 1 (2 de Out. 2025)", image: "https://i.postimg.cc/bNtRN7H4/IMG-20251111-111459.jpg", url: CONSTRUCTION_LINK },
    { title: "May I Ask for One Final Thing?", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/ZY9QpDLk/filters-quality-95-format-webp-6.jpg", url: CONSTRUCTION_LINK },
    { title: "Kakuriyo: Bed & Breakfast for Spirits S2", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/VLqDFyr0/81l-Bp-Kc-TSr-L.jpg", url: CONSTRUCTION_LINK },
    { title: "With You, Our Love Will Make It Through", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/cH3Q4Yfg/images-13.webp", url: CONSTRUCTION_LINK },
    { title: "A Star Brighter than the Sun", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/YSW417jt/images-14.webp", url: CONSTRUCTION_LINK },
    { title: "Who Made Me a Princess", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/jdDRWXDR/images-15.webp", url: CONSTRUCTION_LINK },
    { title: "The Banished Court Magician Aims to Become the Strongest", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/yxt4hMkM/images-16.webp", url: CONSTRUCTION_LINK },
    { title: "A Gatherer’s Adventure in Isekai", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/xTGqj5hJ/images-2025-11-11T112830-071.jpg", url: CONSTRUCTION_LINK },
    { title: "Dad is a Hero, Mom is a Spirit, I’m a Reincarnator", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/NFWS2Rns/images-2025-11-11T112142-360.jpg", url: CONSTRUCTION_LINK },
    { title: "Blue Orchestra S2", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/mr5vGxSy/images-2025-11-11T112238-100.jpg", url: CONSTRUCTION_LINK },
    { title: "Kingdom S6", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/LswbbtHN/images-2025-11-11T112334-528.jpg", url: CONSTRUCTION_LINK },
    { title: "To Your Eternity S3", subtitle: "Ep. 1 (Outono 2025)", image: "https://i.postimg.cc/nhLSVRr9/images-2025-11-11T112408-236.jpg", url: CONSTRUCTION_LINK },
    
],
            // -------------------------------------------------------------
            // Populares (Animes de grande sucesso e audiência)
            // -------------------------------------------------------------
            popularAnimes: [
                { title: "Naruto Shippuden", subtitle: "500 Episódios", image: "https://i.postimg.cc/02VxHSDp/IMG-20251111-095340.jpg", url: CONSTRUCTION_LINK },
                { title: "Dragon Ball Super", subtitle: "131 Episódios", image: "https://i.postimg.cc/DwDtGPkM/IMG-20251111-101701.jpg", url: CONSTRUCTION_LINK },
                { title: "Death Note", subtitle: "37 Episódios", image: "https://i.postimg.cc/NGd2Rpbb/IMG-20251111-103316.jpg", url: CONSTRUCTION_LINK },
                { title: "Fullmetal Alchemist: Brotherhood", subtitle: "64 Episódios", image: "https://i.postimg.cc/xTRQX4Rc/IMG-20251111-103449.jpg", url: CONSTRUCTION_LINK },
                { title: "Hunter x Hunter (2011)", subtitle: "148 Episódios", image: "https://i.postimg.cc/Pr6cssyV/IMG-20251111-103924.jpg", url: CONSTRUCTION_LINK },
                { title: "Haikyuu!!", subtitle: "4 Temporadas + Filmes", image: "https://i.postimg.cc/zGgkd9cK/IMG-20251111-104051.jpg", url: CONSTRUCTION_LINK },
                { title: "Sword Art Online", subtitle: "T1, T2, T3 + Filmes", image: "https://i.postimg.cc/5tfFwTd4/IMG-20251111-104238.jpg", url: CONSTRUCTION_LINK },
                { title: "One Punch Man", subtitle: "2 Temporadas", image: "https://i.postimg.cc/5tfFwTd4/IMG-20251111-104238.jpg", url: CONSTRUCTION_LINK },
                { title: "Spy x Family", subtitle: "2 Temporadas + Filme", image: "https://i.postimg.cc/nLwBp25K/IMG-20251111-104434.jpg", url: CONSTRUCTION_LINK },
                { title: "Vinland Saga", subtitle: "2 Temporadas", image: "https://i.postimg.cc/vBfBkvd3/IMG-20251111-104607.jpg", url: CONSTRUCTION_LINK },
                { title: "Mob Psycho 100", subtitle: "3 Temporadas", image: "https://i.postimg.cc/RhPzD3qC/IMG-20251111-104810.jpg", url: CONSTRUCTION_LINK },
                { title: "Steins;Gate", subtitle: "24 Episódios + Filme", image: "https://i.postimg.cc/CKp9JCJH/IMG-20251111-104940.jpg", url: CONSTRUCTION_LINK },
                { title: "Demon Slayer: Kimetsu no Yaiba", subtitle: "Todas as Temporadas", image: "https://i.postimg.cc/PqHF1XrF/IMG-20251111-105046.jpg", url: CONSTRUCTION_LINK },
                { title: "A Viagem de Chihiro", subtitle: "Filme Clássico", image: "https://i.postimg.cc/mgyKXzq7/IMG-20251111-105228.jpg", url: CONSTRUCTION_LINK },
                { title: "Your Name", subtitle: "Filme", image: "https://i.postimg.cc/V6ffZPDN/MV5BOTkz-MGIy-Yz-At-MDQy-Yi00OTkx-LWI2ZGMt-ODNm-Yj-My-MWM3ZGY1Xk-Ey-Xk-Fqc-Gc-V1.jpg", url: CONSTRUCTION_LINK },
            ],
            // -------------------------------------------------------------
            // Adicionados Recentemente (Animes recém-inseridos na plataforma)
            // -------------------------------------------------------------
            recentlyAdded: [
                { title: "Solo Leveling", subtitle: "12 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "The Apothecary Diaries", subtitle: "24 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Mushoku Tensei S2", subtitle: "25 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Cyberpunk: Edgerunners", subtitle: "10 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Ranking of Kings", subtitle: "23 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Spy x Family S1", subtitle: "25 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Jojo's Bizarre Adventure: Stone Ocean", subtitle: "38 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Tengen Toppa Gurren Lagann", subtitle: "27 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Code Geass", subtitle: "2 Temporadas", image: "", url: CONSTRUCTION_LINK },
                { title: "Violet Evergarden", subtitle: "13 Episódios + Filme", image: "", url: CONSTRUCTION_LINK },
                { title: "Hajime no Ippo", subtitle: "75 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Slam Dunk", subtitle: "101 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Yu Yu Hakusho", subtitle: "112 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Rurouni Kenshin (2023)", subtitle: "24 Episódios", image: "", url: CONSTRUCTION_LINK },
                { title: "Trigun Stampede", subtitle: "12 Episódios", image: "", url: CONSTRUCTION_LINK },
            ],
            // As seções 'Visualizados Recentemente' e 'Gêneros' manterão o comportamento de carregar do HTML externo
            // mas terão o novo ID do carrossel no buildHomepage para o novo carrossel.
        };

        window.searchAnimes = async (query) => {
            console.log(`[BUSCA] Chamada para searchAnimes com query: "${query}"`);
            const resultsList = document.getElementById('result-card');
            const lowerQuery = query.trim().toLowerCase();
            
            if (!lowerQuery) {
                console.log('[BUSCA] Query vazia. Escondendo resultados.');
                resultsList.style.display = 'none';
                resultsList.innerHTML = '';
                return;
            }
            const firstLetter = lowerQuery[0];
            if (!firstLetter.match(/^[a-z]$/)) {
                console.log(`[BUSCA] Primeiro caractere (${firstLetter}) não é uma letra. Escondendo resultados.`);
                resultsList.style.display = 'none';
                resultsList.innerHTML = '';
                return;
            }
            
            const results = [];
            
            try {
                console.log(`[FIREBASE/BUSCA] Buscando documento 'pesquisa_animes/${firstLetter}'...`);
                const docRef = doc(db, 'pesquisa_animes', firstLetter);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    console.log(`[FIREBASE/BUSCA] Documento encontrado. Total de itens a verificar: ${Object.keys(data).length}`);
                    for (const [animeKey, animeData] of Object.entries(data)) {
                        const lowerTitle = animeData.title ? animeData.title.toLowerCase() : '';
                        const lowerKey = animeKey.toLowerCase();
                        if (lowerTitle.startsWith(lowerQuery) || lowerKey.startsWith(lowerQuery)) {
                            results.push({
                                ...animeData,
                                key: animeKey,
                                title: animeData.title || animeKey
                            });
                        }
                    }
                    console.log(`[BUSCA] Resultados filtrados: ${results.length} animes encontrados.`);
                } else {
                    console.log('[FIREBASE/BUSCA] Nenhum documento encontrado para a primeira letra.');
                }
            } catch (error) {
                console.error('[FIREBASE/BUSCA] Erro na busca:', error);
            }

            results.sort((a, b) => a.title.localeCompare(b.title));

            if (results.length > 0) {
                console.log('[BUSCA] Exibindo resultados da pesquisa.');
                resultsList.innerHTML = '';
                results.forEach(anime => {
                    const resultItem = document.createElement('a');
                    resultItem.href = anime.watch_url || CONSTRUCTION_LINK;
                    resultItem.target = '_blank';
                    resultItem.className = 'result-suggestion-item';
                    resultItem.innerHTML = `
                        <i class="${anime.thumbnail_icon || 'fas fa-book'}"></i>
                        <span class="result-suggestion-title">${anime.title}</span>
                    `;
                    resultsList.appendChild(resultItem);
                    if (analytics) {
                         logEvent(analytics, 'search_suggestion_shown', { anime: anime.title, query: query });
                         console.log(`[ANALYTICS] Evento 'search_suggestion_shown' logado para: ${anime.title}`);
                    }
                });
                resultsList.style.display = 'flex';
                resultsList.classList.add('show');
            } else {
                console.log('[BUSCA] Nenhum resultado encontrado. Escondendo resultados.');
                resultsList.style.display = 'none';
                resultsList.innerHTML = '';
            }
            console.log('[BUSCA] Finalizando searchAnimes.');
        };

        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return "IP_NAO_DISPONIVEL";
            }
        }
        async function recordReportError(errorType) {
             console.info(`[REGISTRO] Tentativa de registrar Reporte de Erro: ${errorType} (Homepage)`);
             const reportRef = collection(db, 'report_homepage');
             const userIP = await getIPAddress();
             try {
                await addDoc(reportRef, {
                    timestamp: new Date().toISOString(),
                    errorType: errorType,
                    ipAddress: userIP,
                    userAgent: navigator.userAgent
                });
                showNotification('Problema reportado com sucesso! Obrigado.');
                closeReportModal();
             } catch (e) {
                console.error("[FIREBASE] ERRO ao registrar Reporte de Erro no Firestore. Detalhes:", e);
                showNotification('Erro ao enviar reporte.');
             }
        }

        function openHamburgerMenu() {
            console.log('[MENU] Abrindo menu hambúrguer.');
            document.getElementById('hamburgerMenu')?.classList.add('open');
            document.getElementById('menuOverlay')?.classList.add('active');
        }

        function closeHamburgerMenu() {
            console.log('[MENU] Fechando menu hambúrguer.');
            document.getElementById('hamburgerMenu')?.classList.remove('open');
            document.getElementById('menuOverlay')?.classList.remove('active');
        }
        window.closeHamburgerMenu = closeHamburgerMenu;


        function showNotification(message) {
            const notification = document.getElementById('notification');
            if (!notification) {
                console.warn('[NOTIFICAÇÃO] Elemento de notificação não encontrado.');
                return;
            }
            console.log(`[NOTIFICAÇÃO] Exibindo: "${message}"`);
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        window.showNotification = showNotification; // Permite o uso em links "javascript:..."

        function openReportModal() {
            console.log('[MODAL] Abrindo modal de reporte de erro.');
            const modal = document.getElementById('reportErrorModal');
            if (modal) {
                 modal.style.display = 'flex';
            }
        }

        function closeReportModal() {
            console.log('[MODAL] Fechando modal de reporte de erro.');
            const modal = document.getElementById('reportErrorModal');
            if (modal) {
                 modal.style.display = 'none';
            }
        }

        function buildAnimeGrid(containerId, animeList) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.warn(`[HOMEPAGE] Container de grid não encontrado: ${containerId}`);
                return;
            }
            container.innerHTML = ''; 
            animeList.forEach((anime, index) => {
                const card = document.createElement('a');
                // Link é CONSTRUCTION_LINK se a URL for "#" ou vazia
                const finalUrl = (anime.url === '#' || !anime.url) ? CONSTRUCTION_LINK : anime.url;
                const finalSubtitle = finalUrl === CONSTRUCTION_LINK ? CONSTRUCTION_SUBTITLE : anime.subtitle;

                card.href = finalUrl;
                card.className = 'anime-card';
                card.style.animationDelay = `${index * 50}ms`;
                
                card.innerHTML = `
                    <div class="anime-card-image" style="background-image: url('${anime.image}')"></div>
                    <div class="anime-card-info">
                        <div class="anime-card-title">${anime.title}</div>
                        <div class="anime-card-subtitle">${finalSubtitle}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function buildHeroSlider(containerId, heroList) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.warn(`[HOMEPAGE] Container de herói não encontrado: ${containerId}`);
                return;
            }
            container.innerHTML = ''; 
            heroList.forEach((item, index) => {
                const finalUrl = (item.url === '#' || !item.url) ? CONSTRUCTION_LINK : item.url;
                
                const slide = document.createElement('a');
                slide.href = finalUrl;
                slide.className = `hero-slide ${index === 0 ? 'active' : ''}`;
                slide.innerHTML = `
                    <img src="${item.image}" alt="${item.title}" loading="${index === 0 ? 'eager' : 'lazy'}" />
                    <div class="hero-info">
                        <h2>${item.title}</h2>
                        <p>${item.subtitle}</p>
                    </div>
                `;
                container.appendChild(slide);
            });

            let currentHero = 0;
            setInterval(() => {
                const slides = container.querySelectorAll('.hero-slide');
                if (slides.length <= 1) return;
                
                slides[currentHero].classList.remove('active');
                currentHero = (currentHero + 1) % slides.length;
                slides[currentHero].classList.add('active');
            }, 5000); 
        }

        // ==========================================================
        // ✨ INÍCIO DA INTEGRAÇÃO DO CÓDIGO 1
        // ==========================================================

        /**
         * Carrega HTML externo e SUBSTITUI o conteúdo de um container.
         * Note: Este comportamento de carregar HTML externo em um grid 
         * é mantido para compatibilidade com o código original (C1).
         */
        async function carregarCarrosselExterno(id, arquivo) {
          try {
            const resp = await fetch(arquivo);
            if (!resp.ok) throw new Error(`Falha ao carregar ${arquivo}: ${resp.statusText}`);
            const html = await resp.text();
            const container = document.getElementById(id);
            if (container) {
              container.innerHTML = html; 
              console.log(`[CARGA EXTERNA] Conteúdo de ${arquivo} inserido em #${id}`);
              // Pós-processamento para links (opcional, dependendo do conteúdo do HTML externo)
              // Geralmente o conteúdo externo já deve estar formatado corretamente.
            } else {
              console.warn(`[CARGA EXTERNA] Container #${id} não encontrado.`);
            }
          } catch (error) {
            console.error(`[CARGA EXTERNA] Erro ao carregar ${arquivo}:`, error);
            // Injeta cards de erro para preencher a seção
            const container = document.getElementById(id);
            if (container) {
                 const errorList = Array(15).fill({ 
                    title: "Erro de Carga", 
                    subtitle: "Arquivo Externo: " + arquivo.split('/').pop(), 
                    image: "https://i.postimg.cc/767RBnPq/f144ebc9f61c734140f789b23edc4eeb.jpg", 
                    url: CONSTRUCTION_LINK 
                 });
                 buildAnimeGrid(id, errorList); // Reutiliza a função de build com a mensagem de erro.
            }
          }
        }

        // ==========================================================
        // ✨ FIM DA INTEGRAÇÃO DO CÓDIGO 1
        // ==========================================================


        function buildHomepage() {
            console.log('[HOMEPAGE] Construindo página inicial (Dados Internos)...');
            buildHeroSlider('hero-section', homepageData.hero);
            buildAnimeGrid('recent-releases-grid', homepageData.recentReleases);
            buildAnimeGrid('popular-animes-grid', homepageData.popularAnimes);
            // NOVO CARROSSEL
            buildAnimeGrid('recently-added-grid', homepageData.recentlyAdded);
        }

        const INITIAL_ZOOM = parseFloat(localStorage.getItem('zoomLevel')) || 0.75;
        const MIN_ZOOM = 0.5;
        const MAX_ZOOM = 1.5;

        function setupEventListeners() {
            console.log('13. [EVENTOS] Configurando event listeners (Modo Homepage)...');
            
            const searchInput = document.getElementById('search-input');
            const menuToggle = document.getElementById('menu-icon');
            const mainMenu = document.getElementById('main-menu');
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.body;
            const zoomInBtnFixed = document.getElementById('zoom-in-btn-fixed');
            const zoomOutBtnFixed = document.getElementById('zoom-out-btn-fixed');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const menuOverlay = document.getElementById('menuOverlay');
            const rootElement = document.documentElement;
            let currentScale = INITIAL_ZOOM;
            const step = 0.05;
            const baseFontSize = 16;

            function updateZoom() {
                console.log(`[ZOOM] Atualizando zoom para: ${currentScale.toFixed(2)}`);
                rootElement.style.fontSize = `${baseFontSize * currentScale}px`;
                showNotification(`Zoom: ${Math.round(currentScale * 100)}%`);
                localStorage.setItem('zoomLevel', currentScale.toFixed(2));
                
                const isDisabledMax = currentScale >= MAX_ZOOM;
                const isDisabledMin = currentScale <= MIN_ZOOM;
                
                if (zoomInBtnFixed) zoomInBtnFixed.disabled = isDisabledMax;
                if (zoomOutBtnFixed) zoomOutBtnFixed.disabled = isDisabledMin;
            }
            function handleZoom(direction) {
                if (direction === 'in') {
                    currentScale = Math.min(MAX_ZOOM, currentScale + step);
                } else if (direction === 'out') {
                    currentScale = Math.max(MIN_ZOOM, currentScale - step);
                }
                currentScale = parseFloat(currentScale.toFixed(2));
                updateZoom();
            }
            zoomInBtnFixed?.addEventListener('click', () => handleZoom('in'));
            zoomOutBtnFixed?.addEventListener('click', () => handleZoom('out'));
            updateZoom(); 

            hamburgerBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                openHamburgerMenu();
            });
            menuOverlay?.addEventListener('click', closeHamburgerMenu);

            searchInput?.addEventListener('input', (e) => {
                window.searchAnimes(e.target.value);
            });
            menuToggle?.addEventListener('click', (e) => {
                e.stopPropagation();
                mainMenu.classList.toggle('open');
                if (mainMenu.classList.contains('open') && searchInput) {
                    setTimeout(() => searchInput.focus(), 300);
                }
            });
            document.addEventListener('click', (e) => {
                if (mainMenu && !e.target.closest('#main-menu') && !e.target.closest('#menu-icon') && mainMenu.classList.contains('open')) {
                    mainMenu.classList.remove('open');
                }
            });

            function toggleTheme() {
                const newTheme = body.dataset.theme === 'light' ? 'dark' : 'light';
                body.dataset.theme = newTheme;
                localStorage.setItem('theme', newTheme);
            }
            themeToggle?.addEventListener('click', toggleTheme);
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.dataset.theme = savedTheme;

            document.getElementById('closeReportModal')?.addEventListener('click', closeReportModal);
            document.getElementById('reportErrorModal')?.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal-overlay')) {
                    closeReportModal();
                }
            });
            document.querySelectorAll('.report-option').forEach(button => {
                button.addEventListener('click', (e) => {
                    const errorType = e.currentTarget.dataset.errorType;
                    recordReportError(errorType);
                });
            });

            console.log('14. [EVENTOS] Configuração de event listeners concluída.');
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('17. [DOM] DOMContentLoaded. Chamando buildHomepage() e setupEventListeners().');
            
            // 1. Carrega o conteúdo interno (Dados do JS)
            buildHomepage();
            
            // 2. Configura todos os eventos
            setupEventListeners();

            // 3. (INTEGRAÇÃO C1) Carrega o conteúdo externo nos containers originais
            console.log('17b. [CARGA EXTERNA] Iniciando carregamento de carrosséis externos...');
            
            // O HTML original usa 'carrossel-recentes.html' e 'carrossel-populares.html'
            // para preencher o grid 'recentes-externo-grid' (Visualizados) e 'generos-externo-grid' (Gêneros)
            
           // CORREÇÃO: Adicionando as chamadas de função para carregar os carrosséis externos
           carregarCarrosselExterno('recentes-externo-grid', 'carrossel-recentes.html');
           carregarCarrosselExterno('generos-externo-grid', 'carrossel-generos.html');
           // A linha incorreta "carrossel-recentes.html" foi removida e substituída pelas duas chamadas acima.

        window.addEventListener('beforeunload', () => {
            console.log('[LIFECYCLE] Evento beforeunload. Salvando estado...');
            localStorage.setItem('theme', document.body.dataset.theme);
            localStorage.setItem('zoomLevel', (parseFloat(document.documentElement.style.fontSize) / 16 || INITIAL_ZOOM).toFixed(2));
        });
        
        console.log('18. [FINAL] Script da Homepage carregado.');
    </script>
</body>
</html>
